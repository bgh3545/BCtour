<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
        
<mapper namespace = "com.greenart.ch1">
	<select id="p_selectAll" resultType="ListDto">
		SELECT * FROM pd_info
	</select>
	<delete id = "p_deleteAll" parameterType = "int">
		DELETE FROM pd_info
		WHERE pd_num = #{pd_num}
	</delete>
	<select id="productInfoSelectAll" resultType="productInfoDto">
		select * from pd_info
	</select>
	<select id="productInfoSelect" parameterType = "int" resultType="productInfoDto">
		select * from pd_info
		where pd_num = #{pd_num}
	</select>
	<sql id="selectFromProduct">
      SELECT * FROM pd_info
   </sql>
   
   <select id="p_searchSelectPage" parameterType="map" resultType="ListDto">
      <include refid="selectFromProduct"/>
      where pd_city = #{pd_city}
      <include refid="p_searchCondition"/>
      order by reg_date desc, pd_num desc
      limit #{offset}, #{pageSize}
   </select>
   
   <select id="p_searchResultCnt" parameterType="map" resultType="int">
      select count(*) from pd_info
      where pd_city = #{pd_city}
      <include refid="p_searchCondition"/>
   </select>
   <insert id ="insertInfo" parameterType="ListDto">
   	  insert into pd_info(pd_title,pd_subtitle,pd_days,pd_transport,pd_departStart,pd_departEnd,pd_deportStart,pd_deportEnd,pd_city1,pd_reserveUntil) values(#{pd_title},#{pd_subtitle},#{pd_days},#{pd_transport},#{pd_departStart},#{pd_departEnd},#{pd_deportStart},#{pd_deportEnd},#{pd_city1},#{pd_reserveUntil})
   </insert>
  <select id ="seoulList" parameterType ="String" resultType = "ListDto">
  		select * from pd_info
  		where pd_city = "서울" 
  </select>
   
   <sql id="p_searchCondition">
      <choose>
         <when test='option=="T"'>
            and pd_title like concat('%',#{keyword},'%')
         </when>
         <otherwise>
            and (pd_title like concat('%',#{keyword},'%')
            or 
            pd_subtitle like concat('%',#{keyword},'%'))
         </otherwise>
      </choose>
   </sql>
</mapper>